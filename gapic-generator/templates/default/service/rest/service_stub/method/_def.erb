<%- assert_locals method -%>
##
<%- if method.doc_description -%>
  <%= indent method.doc_description, "# " %>
  #
<%- end -%>
# @param request_pb [<%= method.request_type %>]
#   A request object representing the call parameters. Required.
# @param options [::Gapic::CallOptions]
#   Overrides the default settings for this call, e.g, timeout, retries, etc. Optional.
# @return [<%= method.return_type %>]
def <%= method.name %> request_pb, options:, &block
  (uri, <%- if method.rest.body? -%> body <%- else -%> _ <%- end -%>, <%- if method.rest.query_string_params? -%> query_string_params <%- else -%> __ <%- end -%>) = <%= method.rest.transcoding_helper_name %> request_pb

  response = @client_stub.make_<%= method.rest.verb %>_request(
    uri:     uri,
<%- if method.rest.body? -%>
    body:    body,
<%- end -%>
<%- if method.rest.query_string_params? -%>
    params:  query_string_params,
<%- end -%>
    options: options,
  )

  result = <%= method.return_type %>.decode_json response.body, ignore_unknown_fields: true

  yield result, response if block_given?

  result
end
