<%- assert_locals method -%>
##
<%- if method.doc_description -%>
  <%= indent method.doc_description, "# " %>
  #
<%- end -%>
# @param request_pb [<%= method.request_type %>]
#   A request object representing the call parameters. Required.
# @param options [::Gapic::CallOptions]
#   Overrides the default settings for this call, e.g, timeout, retries, etc. Optional.
# @return [<%= method.return_type %>]
def <%= method.name %> request_pb, options:, &block
  uri = "<%= method.rest.uri_interpolated %>"
  <%- if method.rest.body? -%>
  body = <%= method.rest.body_interpolated %>
  <%- end -%>
  <%- if method.rest.query_string_params? -%>
  query_string_params = {
    <%- method.rest.query_string_params_interpolated.each do | camel_name, val, interpolated_val| -%>
    "<%= camel_name %>" => "<%= interpolated_val %>" if <%= val %>
    <%- end -%>  
  }
  <%- end -%>

  result_json = @client_stub.make_<%= method.rest.verb %>_request(
    uri:     uri,
<%- if method.rest.body? -%>
    body:    body,
<%- end -%>
<%- if method.rest.query_string_params? -%>
    params:  query_string_params,
<%- end -%>
    options: options,
    &block
  )

  <%= method.return_type %>.decode_json result_json[:body], { ignore_unknown_fields: true }
end
