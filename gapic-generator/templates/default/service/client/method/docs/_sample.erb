<%- assert_locals service, sample -%>
require "<%= service.service_require %>"

client = <%= service.client_name_full %>.new

<%- sample.input_parameters.each do |field| -%>
<%= field.input_parameter %> = <%= field.value %>
<%- end -%>

<%- sample.fields.each_pair do |k,v| -%>
<%= k %> = {
<%- v.each_pair do |k2,v2| -%>
<%- if v2.comment  -%>
<%= indent v2.comment, "  # " %>
<%- end -%>
  <%= k2 %>: <%= v2.input_parameter ? v2.input_parameter : v2.value %><%= "," unless v2 == v.values.last %>
<%- end -%>
}
<%- end -%>

response = client.recognize config: config, audio: audio
<%= sample.response_variable %> = response.results

# First alternative is the most probable result
alternative = result.alternatives[0]
puts "Transcript: #{alternative.transcript}"
